<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>03-2-spoc</title>
    <link rel="stylesheet" href="http://cdn.bootcss.com/bootstrap/3.3.5/css/bootstrap.min.css">
</head>
<body>
<div class="container">
    <div class="col-lg-6">
        <div class="panel panel-default">
            <div class="panel-heading">题目:03-2-spoc va2pa</div>
            <div class="panel-body">
                <p>
                    有一台只有页机制的简化80386的32bit计算机，有地址范围位0~256MB的物理内存空间（physical
                    memory），可表示大小为256MB，范围为0xC0000000~0xD0000000的虚拟地址空间（virtual address space）,页大小（page
                    size）为4KB，采用二级页表，一个页目录项（page directory entry ，PDE）大小为4B,一个页表项（page-table entries
                    PTEs）大小为4B，1个页目录表大小为4KB，1个页表大小为4KB。
                </p>
                <pre><code>PTE格式（32 bit） :
PFN19 ... PFN0|NOUSE9 ... NOUSE0|WRITABLE|VALID
PDE格式（32 bit） :
PT19 ... PT0|NOUSE9 ... NOUSE0|WRITABLE|VALID

其中：
NOUSE9 ... NOUSE0为保留位，要求固定为0
WRITABLE：1表示可写，0表示只读
VLAID：1表示有效，0表示无效</code></pre>
                <p>
                    假设ucore OS已经为此机器设置好了针对如下虚拟地址<-->物理地址映射的二级页表，设置了页目录基址寄存器（page directory base
                    register，PDBR）保存了页目录表的物理地址（按页对齐），其值为0。已经建立好了从物理地址0x1000~0x41000的二级页表，且页目录表的index为0x300~0x363的页目录项的(PT19
                    ... PT0)的值=(index-0x300+1)。
                    请写出一个translation程序（可基于python、ruby、C、C++、LISP、JavaScript等），输入是一个虚拟地址和一个物理地址，能够自动计算出对应的页目录项的index值,页目录项内容的值，页表项的index值，页表项内容的值。即(pde_idx,
                    pde_ctx, pte_idx, pte_cxt)
                </p>
                <p>参考的输出格式为：</p>
                <pre><code>va 0xcd82c07c, pa 0x0c20907c, pde_idx 0x00000336, pde_ctx  0x00037003, pte_idx 0x0000002c, pte_ctx  0x0000c20b
</code></pre>
            </div>
        </div>
    </div>
    <div class="col-lg-6">
        <div class="panel panel-default">
            <div class="panel-heading">测试数据</div>
            <div class="panel-body">
                <p>请用如下值来验证你写的程序的正确性：</p>
                <pre><code>va 0xc2265b1f, pa 0x0d8f1b1f
va 0xcc386bbc, pa 0x0414cbbc
va 0xc7ed4d57, pa 0x07311d57
va 0xca6cecc0, pa 0x0c9e9cc0
va 0xc18072e8, pa 0x007412e8
va 0xcd5f4b3a, pa 0x06ec9b3a
va 0xcc324c99, pa 0x0008ac99
va 0xc7204e52, pa 0x0b8b6e52
va 0xc3a90293, pa 0x0f1fd293
va 0xce6c3f32, pa 0x007d4f32
</code></pre>

            </div>
        </div>
    </div>
    <div class="col-lg-6">
    <div class="panel panel-info">
            <div class="panel-heading">解答:</div>
            <div class="panel-body">
                <input class="form-control" type="text" placeholder="virtual address" id="va">
                    <input class="form-control" type="text" placeholder="physic address" id="pa">
                    <button class="btn btn-default" onclick="trans();">translate</button>
                    <pre><code id="ans"></code></pre>
                </div>
        </div>
        </div>

</div>
</body>
</html>

<script src="http://cdn.bootcss.com/jquery/1.11.3/jquery.js"></script>
<script src="http://cdn.bootcss.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
<script src="http://cdn.bootcss.com/sprintf/1.0.3/sprintf.js"></script>
<script type="application/javascript">

    function gethex(id) {
        hex = $('#'+id).val();
        if (hex.substring(0,2) !== "0x") {
            alert("请输入十六进制数(以0x开头)");
            return NaN;
        }
        hex = parseInt(hex,16);
        if (isNaN(hex)) {
            alert("请输入十六进制数(以0x开头)");
            return NaN;
        }
        return hex;
    }
    function trans() {
        va = gethex('va');
        if (isNaN(va)) return;
        pa = gethex('pa');
        if (isNaN(pa)) return;

        pde_idx = (va >> 22) & 0x3FF;
        pde_ctx = (pde_idx - 0x300 + 1) << 12 | 0x3;

        pte_idx = (va >> 12) & 0x3FF;
        pte_ctx = ((pa >> 12) << 12) | 0x3;

        ans = vsprintf("va 0x%08x, pa 0x%08x, pde_idx 0x%08x, pde_ctx 0x%08x, pte_idx 0x%08x, pte_ctx 0x%08x",
                [va,pa,pde_idx,pde_ctx,pte_idx,pte_ctx]);
        $('#ans').text(ans);
    }
</script>